import{a as M}from"./chunk-XYDF42MX.js";import{a as E,b as w}from"./chunk-3UXZUV3X.js";import{$c as I,Eb as c,Fb as d,Gb as f,Mb as v,Vc as S,Wc as P,Yb as b,Zb as D,dc as j,eb as l,ia as x,na as C,tb as m,vb as p,yb as y}from"./chunk-PYOKKVX2.js";import"./chunk-GAL4ENT6.js";function R(o,s){if(o&1&&(c(0,"div",3)(1,"div",5),f(2,"i"),c(3,"div")(4,"div",6),b(5),d(),c(6,"div",7),b(7),d(),c(8,"div",8),b(9),d()()()()),o&2){let a=s.$implicit;l(2),y(a.icon+" text-3xl text-blue-600"),l(3),D(a.value),l(2),D(a.title),l(2),D(a.description)}}function k(o,s){if(o&1&&(c(0,"div"),f(1,"apx-chart",9),d()),o&2){let a=v();l(),p("series",a.barChart.series)("chart",a.barChart.chart)("xaxis",a.barChart.xaxis)("colors",a.barChart.colors)("plotOptions",a.barChart.plotOptions)("dataLabels",a.barChart.dataLabels)("stroke",a.barChart.stroke)("fill",a.barChart.fill)("grid",a.barChart.grid)("yaxis",a.barChart.yaxis)}}function T(o,s){if(o&1&&(c(0,"div"),f(1,"apx-chart",10),d()),o&2){let a=v();l(),p("series",a.donutChart.series)("chart",a.donutChart.chart)("labels",a.donutChart.labels)("colors",a.donutChart.colors)("responsive",a.donutChart.responsive)("legend",a.donutChart.legend)}}var H=(()=>{let s=class s{constructor(){this.pengajuanService=x(M),this.totalPengajuanHariIni=0,this.userRole="",this.summaryCards=[{icon:"bi bi-file-earmark-text",title:"Total Pengajuan Hari Ini",value:0,description:"Semua status"},{icon:"bi bi-hourglass-split",title:"Pengajuan Pending Siap Proses",value:0,description:""},{icon:"bi bi-check-circle",title:"Pengajuan Disetujui Hari Ini",value:0,description:"Disetujui oleh manager"},{icon:"bi bi-cash-stack",title:"Total Pencairan Hari Ini",value:"Rp\xA00",description:"Dari Backoffice"}]}ngOnInit(){this.fetchTotalPengajuanHariIni(),this.userRole=localStorage.getItem("role")??"",console.log("Role dari localStorage:",this.userRole),this.fetchRoleBasedCount(),this.fetchApprovedToday(),this.fetchDisbursedToday(),this.pengajuanService.getAllPengajuan().subscribe({next:e=>{this.initBarChart(e)},error:e=>{console.error("Gagal memuat data chart pengajuan:",e)}}),this.pengajuanService.getAllPengajuan().subscribe({next:e=>{this.initDonutChart(e)},error:e=>{console.error("Gagal mengambil data untuk donut chart:",e)}})}fetchTotalPengajuanHariIni(){this.pengajuanService.getAllPengajuan().subscribe({next:e=>{let t=new Date().toLocaleDateString(),n=e.filter(r=>r.tanggalPengajuan?new Date(r.tanggalPengajuan).toLocaleDateString()===t:!1).length;this.totalPengajuanHariIni=n,this.summaryCards[0].value=n,console.log("Total pengajuan hari ini:",n)},error:e=>{console.error("Gagal ambil data pengajuan:",e)}})}fetchRoleBasedCount(){this.pengajuanService.getAllPengajuan().subscribe({next:e=>{let t,n;switch(this.userRole){case"MARKETING":t="PENDING",n="Menunggu Marketing";break;case"MANAGER":t="REVIEWED",n="Sudah Direview Marketing";break;case"BACKOFFICE":t="APPROVED",n="Siap Dicairkan";break;default:t="",n=""}let r=e.filter(i=>i.status===t).length;this.summaryCards[1].value=r,this.summaryCards[1].description=n},error:e=>{console.error("Gagal mengambil pengajuan sesuai role:",e)}})}fetchApprovedToday(){this.pengajuanService.getAllPengajuan().subscribe({next:e=>{let t=new Date().toLocaleDateString(),n=e.filter(r=>{if(!r.tanggalPengajuan)return!1;let u=new Date(r.tanggalPengajuan).toLocaleDateString();return r.status==="APPROVED"&&u===t}).length;this.summaryCards[2].value=n,this.summaryCards[2].description="Disetujui oleh manager",console.log("Disetujui hari ini:",n)},error:e=>{console.error("Gagal mengambil pengajuan disetujui hari ini:",e)}})}fetchDisbursedToday(){this.pengajuanService.getAllPengajuan().subscribe({next:e=>{let t=new Date().toLocaleDateString(),n=e.filter(i=>{if(!i.tanggalPengajuan)return!1;let h=new Date(i.tanggalPengajuan).toLocaleDateString();return i.status==="DISBURSED"&&h===t}).reduce((i,u)=>i+Number(u.amount??0),0),r=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n);this.summaryCards[3].value=r,this.summaryCards[3].description="Dari Backoffice",console.log("Total pencairan hari ini:",r)},error:e=>{console.error("Gagal mengambil data pencairan hari ini:",e)}})}initBarChart(e){let t=new Map;for(let i=0;i<7;i++)t.set(i,0);e.forEach(i=>{if(!i.tanggalPengajuan)return;let h=new Date(i.tanggalPengajuan).getDay();t.set(h,(t.get(h)??0)+1)});let r=[1,2,3,4,5,6,0].map(i=>t.get(i)??0);this.barChart={series:[{name:"Pengajuan",data:r}],chart:{height:300,type:"bar",toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{show:!0,width:1},colors:["#4361ee"],xaxis:{categories:["Sen","Sel","Rab","Kam","Jum","Sab","Min"],axisBorder:{color:"#e0e6ed"}},yaxis:{opposite:!1,reversed:!1},grid:{borderColor:"#e0e6ed"},plotOptions:{bar:{horizontal:!0}},fill:{opacity:.8}}}initDonutChart(e){let t=e.length,n=e.filter(g=>g.status==="PENDING").length,r=e.filter(g=>g.status==="APPROVED").length,i=e.filter(g=>g.status==="REJECTED").length,u=e.filter(g=>g.status==="DISBURSED").length,h=t===0?[0,0,0,0]:[Math.round(n/t*100),Math.round(r/t*100),Math.round(i/t*100),Math.round(u/t*100)];this.donutChart={series:h,chart:{height:300,type:"donut",toolbar:{show:!1}},stroke:{show:!1},labels:["Menunggu","Disetujui","Ditolak","Dicairkan"],colors:["#fbbc05","#00ffff","#ea4335","#00ab55"],responsive:[{breakpoint:480,options:{chart:{width:200}}}],legend:{position:"bottom"}}}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=C({type:s,selectors:[["app-main"]],standalone:!0,features:[j],decls:7,vars:3,consts:[[1,"p-4","grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","mb-6"],["class","bg-white p-4 rounded-xl shadow-md",4,"ngFor","ngForOf"],[1,"p-4","grid","grid-cols-1","lg:grid-cols-2","gap-4","mb-6"],[1,"bg-white","p-4","rounded-xl","shadow-md"],[4,"ngIf"],[1,"flex","items-center","space-x-4"],[1,"text-xl","font-semibold"],[1,"text-sm","text-gray-700"],[1,"text-xs","text-gray-400"],[3,"series","chart","xaxis","colors","plotOptions","dataLabels","stroke","fill","grid","yaxis"],[3,"series","chart","labels","colors","responsive","legend"]],template:function(t,n){t&1&&(c(0,"div",0),m(1,R,10,5,"div",1),d(),c(2,"div",2)(3,"div",3),m(4,k,2,10,"div",4),d(),c(5,"div",3),m(6,T,2,6,"div",4),d()()),t&2&&(l(),p("ngForOf",n.summaryCards),l(3),p("ngIf",n.barChart),l(2),p("ngIf",n.donutChart))},dependencies:[I,S,P,w,E]});let o=s;return o})();export{H as MainComponent};
