import{a as L}from"./chunk-ZRO2VLPL.js";import{A as V,B as j,C as H,y as E}from"./chunk-NGO3WZC3.js";import"./chunk-QEAK2XWR.js";import{$c as S,Eb as r,Fb as l,Kb as _,Lb as f,Mb as s,Vc as I,Wc as y,Xb as w,Yb as c,Zb as v,_b as M,ca as b,dc as C,eb as m,gd as T,ha as k,hd as A,ia as R,na as F,nc as x,tb as g,va as p,vb as d,wa as h}from"./chunk-PYOKKVX2.js";import"./chunk-GAL4ENT6.js";var B=(()=>{let n=class n{constructor(e){this.http=e,this.apiUrl="http://34.148.109.190/be/api/role-feature"}getAuthHeaders(){let e=localStorage.getItem("token");return new T({Authorization:`Bearer ${e}`})}getAllRoles(){return this.http.get("http://34.148.109.190/be/api/employee/roles",{headers:this.getAuthHeaders()})}getAllFeatures(){return this.http.get(`${this.apiUrl}/features`,{headers:this.getAuthHeaders()})}getFeaturesByRole(e){return this.http.get(`${this.apiUrl}/${e}`,{headers:this.getAuthHeaders()})}assignFeaturesToRole(e,i){return this.http.post(`${this.apiUrl}/${e}`,i,{headers:this.getAuthHeaders()})}updateMappings(e){return this.http.post(`${this.apiUrl}/update`,e,{headers:this.getAuthHeaders()})}};n.\u0275fac=function(i){return new(i||n)(k(A))},n.\u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();function D(t,n){if(t&1&&(r(0,"div",10),c(1),l()),t&2){let o=n.data;m(),v(o.namaRole)}}function K(t,n){if(t&1){let o=_();r(0,"button",11),f("click",function(){let i=p(o).data,a=s(),u=w(9);return h(a.openFeatureModal(i,u))}),c(1," Kelola Fitur "),l()}}function N(t,n){if(t&1&&(r(0,"div",12),c(1),l()),t&2){let o=s();m(),M("Kelola Fitur untuk: ",o.selectedRole==null?null:o.selectedRole.namaRole,"")}}function O(t,n){t&1&&(r(0,"div")(1,"p"),c(2,"Memuat fitur..."),l()())}function U(t,n){if(t&1){let o=_();r(0,"label",17)(1,"input",18),f("change",function(){let i=p(o).$implicit,a=s(3);return h(a.toggleFeature(i.featureId))}),l(),r(2,"span"),c(3),l()()}if(t&2){let o=n.$implicit,e=s(3);m(),d("checked",e.selectedFeatureIds.includes(o.featureId)),m(2),v(o.namaFeature)}}function z(t,n){if(t&1&&(r(0,"div",15),g(1,U,4,2,"label",16),l()),t&2){let o=s(2);m(),d("ngForOf",o.features)}}function q(t,n){if(t&1&&g(0,O,3,0,"div",13)(1,z,2,1,"div",14),t&2){let o=s();d("ngIf",o.features.length===0),m(),d("ngIf",o.features.length>0)}}function J(t,n){if(t&1){let o=_();r(0,"button",19),f("click",function(){p(o),s();let i=w(9);return h(i.close())}),c(1," Batal "),l(),r(2,"button",20),f("click",function(){p(o);let i=s();return h(i.saveFeatures())}),c(3," Simpan "),l()}}var le=(()=>{let n=class n{constructor(){this.roleService=R(B),this.roles=[],this.features=[],this.selectedFeatureIds=[],this.selectedRole=null,this.showModal=!1,this.loading=!1,this.currentModal=null,this.rows=[],this.cols=[{title:"Nama Role",field:"namaRole"},{title:"Aksi",field:"aksi"}]}ngOnInit(){this.loadRoles()}loadRoles(){this.loading=!0,this.roleService.getAllRoles().subscribe({next:e=>{this.roles=e,this.rows=e,this.loading=!1},error:e=>{console.error("Gagal mengambil data role:",e),this.loading=!1}})}openFeatureModal(e,i){if(!e||!e.roleId){console.error("Role tidak ditemukan atau ID kosong:",e),alert("Role tidak valid. Tidak dapat membuka modal.");return}this.selectedRole=e,this.selectedFeatureIds=[],this.features=[],this.currentModal=i,this.roleService.getAllFeatures().subscribe({next:a=>{this.features=a,this.roleService.getFeaturesByRole(e.roleId).subscribe({next:u=>{this.selectedFeatureIds=u.map($=>$.featureId),i.open(),console.log("Modal dibuka untuk:",this.selectedRole?.namaRole)},error:u=>{console.error("Gagal mengambil fitur role:",u),alert("Gagal mengambil fitur untuk role ini.")}})},error:a=>{console.error("Gagal mengambil semua fitur:",a),alert("Gagal mengambil daftar fitur.")}})}toggleFeature(e){let i=this.selectedFeatureIds.indexOf(e);i>-1?this.selectedFeatureIds.splice(i,1):this.selectedFeatureIds.push(e)}saveFeatures(){this.selectedRole&&this.roleService.assignFeaturesToRole(this.selectedRole.roleId,this.selectedFeatureIds).subscribe({next:()=>{alert("Fitur berhasil disimpan!"),this.currentModal?.close(),this.closeModal()},error:e=>{console.error("Gagal menyimpan fitur:",e),alert("Gagal menyimpan fitur.")}})}closeModal(){this.showModal=!1,this.selectedRole=null,this.selectedFeatureIds=[],this.currentModal=null}};n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=F({type:n,selectors:[["app-role-management"]],standalone:!0,features:[C],decls:16,vars:4,consts:[["modalKelolaFitur",""],["modalHeader",""],["modalBody",""],["modalFooter",""],[1,"panel","mt-6","pb-0"],[1,"mb-5","text-lg","font-semibold","dark:text-white-light"],[1,"datatable"],["skin","whitespace-nowrap bh-table-hover","firstArrow",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M13 19L7 12L13 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> <path opacity="0.5" d="M16.9998 19L10.9998 12L16.9998 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',"lastArrow",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M11 19L17 12L11 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> <path opacity="0.5" d="M6.99976 19L12.9998 12L6.99976 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',"previousArrow",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M15 5L9 12L15 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',"nextArrow",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M9 5L15 12L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',3,"rows","columns","sortable","loading"],["slot","namaRole"],["slot","aksi"],[1,"font-semibold"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"!py-5"],[4,"ngIf"],["class","feature-list",4,"ngIf"],[1,"feature-list"],["class","flex items-center space-x-2 mb-2",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2","mb-2"],["type","checkbox",3,"change","checked"],["type","button",1,"btn","btn-outline-danger","me-2",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,a){i&1&&(r(0,"div")(1,"div",4)(2,"h5",5),c(3,"List Role"),l(),r(4,"div",6)(5,"ng-datatable",7),g(6,D,2,1,"ng-template",8)(7,K,2,0,"ng-template",9),l()()(),r(8,"ngx-custom-modal",null,0),g(10,N,2,1,"ng-template",null,1,x)(12,q,2,2,"ng-template",null,2,x)(14,J,4,0,"ng-template",null,3,x),l()()),i&2&&(m(5),d("rows",a.rows)("columns",a.cols)("sortable",!0)("loading",a.loading))},dependencies:[S,I,y,E,H,j,V,L]});let t=n;return t})();export{le as RoleManagementComponent};
